# Bilibili Regret Pill 🎬 后悔药

一个面向 Bilibili 首页的 Chrome 扩展，在误点“换一换”后可一键恢复上一页推荐，并支持在刷新前后页面之间来回切换。

## 功能特性

✅ **一键撤销/重做** - 在上一页与最新推荐之间快速切换  
✅ **内存快照** - 不依赖持久化存储，页面刷新后自动清空  
✅ **原生风格 UI** - 按钮组紧贴“换一换”下方，低干扰  
✅ **零依赖** - 纯 JavaScript + CSS  
✅ **高性能策略** - 选择器缓存、RAF 节流、批量 DOM 操作
✅ **滚动加载兼容** - 识别并保留加载哨兵节点，避免回退后空白

## 文件结构

```
Bilibili Homepage Regret Pill/
├── icons/                 # 扩展图标
├── manifest.json          # Manifest V3 配置
├── content.js             # 核心逻辑（选择器、快照、Observer）
├── styles.css             # UI 样式
└── README.md              # 本文件
```

## 使用说明

### 安装方法

1. 下载或克隆本项目
2. 打开 `chrome://extensions/`
3. 启用“开发者模式”
4. 点击“加载已解压的扩展程序”，选择项目目录

### 使用流程

1. 打开 https://www.bilibili.com
2. 点击“换一换”后，按钮下方会出现“后退/前进”控制
3. 点击“后退”恢复上一页推荐
4. 点击“前进”回到最新推荐

## 技术实现概览

- **选择器策略**：多级候选选择器 + 文本兜底 + 成功选择器缓存
- **快照机制**：以 DocumentFragment 形式保存刷新前/后的推荐列表
- **性能策略**：Observer + RAF 节流 + debounce，减少高频变更负担
- **滚动哨兵识别**：基于 class/id/role/aria/data-* 等特征保留加载触发节点
- **懒加载修复**：自动处理 data-src/data-background，保障图片显示
- **初始化保障**：首次加载重试，SPA 场景下使用 body observer 兜底

## 注意事项

- 仅在 Bilibili 首页生效，其他页面无效果
- 快照只在内存中保存，刷新页面后会清空
- 恢复的推荐卡片为克隆 DOM，部分动态交互（如悬停预览）可能不可用
- 极端情况下若 B 站改版导致哨兵特征变化，可能影响无限滚动触发
- 若 B 站页面结构变更，需要更新选择器策略

## 故障排除

### 没有出现后退/前进按钮

1. 确认当前在 Bilibili 首页
2. 等待页面内容稳定加载（首次可能 1-2 秒）
3. 重新刷新页面或重启浏览器

### 撤销后图片不显示

1. 刷新页面触发图片重新加载
2. 鼠标悬停卡片触发懒加载

### 回退后下滑不加载

1. 确认扩展已更新到当前版本
2. 若仍出现空白，可能是页面结构变更导致哨兵特征失效

### 查看调试日志

1. 打开浏览器控制台（F12）
2. 将 `content.js` 中 `CONFIG.DEBUG` 设为 `true`
3. 在控制台筛选 `[Regret Pill V2.0.0]` 前缀日志

## 许可证

MIT License
